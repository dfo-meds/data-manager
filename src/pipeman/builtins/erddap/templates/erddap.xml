<dataset type="{{dataset['erddap_dataset_type']['short_name']}}" datasetID="{{dataset['erddap_dataset_id']}}" active="true">
{%- macro render_text(text) -%}
    {%- if text is string -%}
        {{text}}
    {%- elif "und" in text and text['und'] -%}
        {{text['und']}}
    {%- elif "en" in text and "fr" in text and text['en'] and text['fr'] -%}
        {{text["en"]}}  |  {{text['fr']}}
    {%- elif "en" in text and text['en'] -%}
        {{text['en']}}
    {%- elif "fr" in text and text['fr'] -%}
        {{text['fr']}}
    {%- endif -%}
{%- endmacro -%}

{%- macro render_text_once(text) -%}
    {%- if text is string -%}
        {{text}}
    {%- elif "und" in text and text['und'] -%}
        {{text['und']}}
    {%- elif "en" in text and text['en'] -%}
        {{text['en']}}
    {%- elif "fr" in text and text['fr'] -%}
        {{text['fr']}}
    {%- endif -%}
{%- endmacro -%}

{%- macro render_bilingual_attr(attr_name_en, text, attr_name_fr="") -%}

    {%- if not is_multilingual_map(text) -%}
    <att name="{{attr_name_en}}">{{text}}</att>

    {%- elif "und" in text -%}
    <att name="{{attr_name_en}}">{{text['und']}}</att>

    {%- elif "en" in text and "fr" in text -%}
    <att name="{{attr_name_en}}">{{text["en"]}}  |  {{text['fr']}}</att>
    <att name="{{attr_name_en}}_en">{{text['en']}}</att>

    {%- if attr_name_fr -%}
    <att name="{{attr_name_fr}}_fr">{{text['fr']}}</att>
    {%- else -%}
    <att name="{{attr_name_en}}_fr">{{text['fr']}}</att>
    {%- endif -%}

    {%- elif "en" in text -%}
    <att name="{{attr_name_en}}">{{text['en']}}</att>
    {%- elif "fr" in text -%}
    <att name="{{attr_name_en}}">{{text['fr']}}</att>
    {%- endif -%}
{%- endmacro -%}

{%- macro render_variable_attributes(var_attrs) -%}
    <addAttributes>
        {% for name in var_attrs %}
        {{ render_bilingual_attr(name, var_attrs[name]) }}
        {% endfor %}
    </addAttributes>
{%- endmacro -%}
    <reloadEveryNMinutes>10080</reloadEveryNMinutes>
    <fileDir>{{dataset['erddap_data_file_path']}}</fileDir>
    <fileNameRegex>{{dataset['erddap_data_file_pattern']}}</fileNameRegex>
    <recursive>true</recursive>
    <metadataFrom>last</metadataFrom>
    <iso19115File>/cloud_data/config/{{environment}}/metadata/{{dataset.guid()}}.xml</iso19115File>
    <addAttributes>
        {% for name in global_attributes %}
        {{ render_bilingual_attr(name, global_attributes[name]) }}
        {% endfor %}
    </addAttributes>
    {% for var_name, var_type, var_dims, var_attrs, var in variables %}
        {% if var['is_axis'] %}
        <axisVariable>
            <sourceName>{{var_name}}</sourceName>
            {% if var['destination_name'] %}
            <destinationName>{{var['destination_name']}}</destinationName>
            {% endif %}
            {{ render_variable_attributes(var_attrs) }}
        </axisVariable>
        {% else %}
        <dataVariable>
            <sourceName>{{var_name}}</sourceName>
            {% if var['destination_name'] %}
            <destinationName>{{var['destination_name']}}</destinationName>
            {% endif %}
            {% if var['source_data_type'] %}
            <dataType>{{var['source_data_type']['short_name']}}</dataType>
            {% endif %}
            {{ render_variable_attributes(var_attrs) }}
        </dataVariable>
        {% endif %}
    {% endfor %}
</dataset>